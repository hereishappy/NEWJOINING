<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Employee Onboarding — Static</title>
  <style>
    /* Mobile-friendly, large inputs */
    body{font-family:Inter,Arial,sans-serif;background:#f5f6f8;margin:0;padding:12px}
    .card{max-width:900px;margin:12px auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
    h1{color:#0b78e3;text-align:center;margin:0 0 6px;font-size:1.6rem}
    p.lead{text-align:center;color:#444;margin:0 0 12px}
    label{display:block;margin-top:12px;font-size:1rem;font-weight:600}
    input,select,textarea{width:100%;padding:14px;border-radius:10px;border:1px solid #d4d7db;margin-top:6px;font-size:1rem;box-sizing:border-box}
    textarea{min-height:90px}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .files{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .btn-row{display:flex;gap:12px;margin-top:18px}
    button{flex:1;padding:14px;border-radius:10px;border:none;font-weight:700;background:#0b78e3;color:#fff;font-size:1rem;cursor:pointer}
    .status{margin-top:14px;text-align:center;color:#222}
    @media(max-width:640px){.row{flex-direction:column}button{width:100%}}
    /* hide the iframe */
    #submit_iframe{display:none;width:0;height:0;border:0}
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Employee Onboarding</h1>
    <p class="lead">Fill the form and upload docs. Tap Submit when ready.</p>

    <!-- The form POSTS to Apps Script endpoint via hidden iframe -->
    <form id="empForm" method="post" action="YOUR_APP_SCRIPT_EXEC_URL_HERE" target="submit_iframe" enctype="application/x-www-form-urlencoded">
      <!-- Visible fields (same names as your apps script expects) -->
      <label>Employee Name (As per Aadhar)<input name="employeeName" type="text" required /></label>

      <div class="row">
        <div class="col"><label>Date of Birth<input name="dob" type="date" /></label></div>
        <div class="col"><label>Blood Group<input name="bloodGroup" type="text" placeholder="O+" /></label></div>
      </div>

      <label>Marital Status
        <select name="maritalStatus"><option value="">-- select --</option><option>Single</option><option>Married</option><option>Widowed</option><option>Divorced</option></select>
      </label>

      <label>Father name<input name="fatherName" type="text" /></label>
      <label>Permanent Address<textarea name="permanentAddress"></textarea></label>

      <div class="row">
        <div class="col"><label>Contact No<input name="contactNo" type="text" /></label></div>
        <div class="col"><label>Emergency Contact No<input name="emergencyContactNo" type="text" /></label></div>
      </div>

      <label>Relation with Emergency Contact<input name="emergencyRelation" type="text" /></label>
      <label>Name of Emergency Contact<input name="emergencyName" type="text" /></label>
      <label>State<input name="state" type="text" /></label>

      <h3 style="margin-top:12px">Bank & Govt</h3>
      <label>Bank Name<input name="bankName" type="text" /></label>
      <label>Account No<input name="accountNo" type="text" /></label>
      <label>IFSC Code<input name="ifsc" type="text" /></label>
      <label>UAN Number<input name="uan" type="text" /></label>
      <label>ESI No/ WC POLICY<input name="esi" type="text" /></label>
      <label>Aadhar No<input name="aadharNo" type="text" /></label>

      <h3 style="margin-top:10px">Family</h3>
      <label>Father name (repeat)<input name="fatherNameRepeat" type="text" /></label>
      <div class="row">
        <div class="col"><label>Father DOB<input name="fatherDob" type="date" /></label></div>
        <div class="col"><label>Mother DOB<input name="motherDob" type="date" /></label></div>
      </div>
      <label>Mother Name<input name="motherName" type="text" /></label>

      <label>Date of Marriage<input name="marriageDate" type="date" /></label>
      <label>Wife Name<input name="wifeName" type="text" /></label>
      <label>Wife DOB<input name="wifeDob" type="date" /></label>

      <label>No. Childrens<input name="noChildren" type="text" /></label>

      <h4>Child 1</h4>
      <label>Child 1 Name<input name="child1Name" type="text" /></label>
      <label>Son/Daughter<input name="child1Gender" type="text" /></label>
      <label>Child 1 DOB<input name="child1Dob" type="date" /></label>

      <h4>Child 2</h4>
      <label>Child 2 Name<input name="child2Name" type="text" /></label>
      <label>Son/Daughter<input name="child2Gender" type="text" /></label>
      <label>Child 2 DOB<input name="child2Dob" type="date" /></label>

      <h4>Child 3</h4>
      <label>Child 3 Name<input name="child3Name" type="text" /></label>
      <label>Son/Daughter<input name="child3Gender" type="text" /></label>
      <label>Child 3 DOB<input name="child3Dob" type="date" /></label>

      <label>Education<input name="education" type="text" /></label>
      <label>Scaffolding Work Experience<input name="workExperience" type="text" /></label>

      <h3 style="margin-top:12px">Upload Documents</h3>
      <div class="files">
        <!-- visible file inputs (we'll convert to base64 and add hidden fields before submit) -->
        <label>Adhaar Front<input id="adhaarFront" type="file" accept="image/*,application/pdf" /></label>
        <label>Adhaar Back<input id="adhaarBack" type="file" accept="image/*,application/pdf" /></label>
        <label>Bank Passbook<input id="bankPassbook" type="file" accept="image/*,application/pdf" /></label>
        <label>Passport Size Photo<input id="photo" type="file" accept="image/*" /></label>
      </div>

      <!-- Hidden container for injected base64 fields -->
      <div id="hiddenInputs" style="display:none"></div>

      <div class="btn-row" style="margin-top:16px">
        <button id="submitBtn" type="button">Submit</button>
      </div>

      <div id="status" class="status"></div>
    </form>

    <!-- hidden iframe for form submission to avoid navigation & CORS -->
    <iframe name="submit_iframe" id="submit_iframe"></iframe>
  </div>

<script>
  // Replace placeholder (if not already replaced server-side)
  (function(){
    const form = document.getElementById('empForm');
    // If you forgot to replace the action value in the HTML file, you can set it here:
    // form.action = 'https://script.google.com/macros/s/AKfycbzgE5pJwsA_wLlTjwaY1w4cx83H7ihfFj7PD_TZgDQaTndqqO2moAK21neCw1XYa40Ftw/exec';
  })();

  function readFileAsDataURL(file) {
    return new Promise((resolve, reject) => {
      if (!file) return resolve(null);
      const r = new FileReader();
      r.onload = () => resolve(r.result);
      r.onerror = () => reject(new Error('File read error'));
      r.readAsDataURL(file);
    });
  }

  async function prepareAndSubmit() {
    const status = document.getElementById('status');
    status.textContent = 'Preparing upload...';

    // remove old hidden inputs
    const hidden = document.getElementById('hiddenInputs');
    hidden.innerHTML = '';

    // collect visible form fields into the form (they're already in the form)
    // now process files: convert to dataURL and add hidden inputs named file_<type>
    const fileMap = [
      { id: 'adhaarFront', type: 'adhaarFront' },
      { id: 'adhaarBack',  type: 'adhaarBack' },
      { id: 'bankPassbook', type: 'bankPassbook' },
      { id: 'photo', type: 'photo' }
    ];

    const filesPayload = [];

    for (let entry of fileMap) {
      const el = document.getElementById(entry.id);
      if (el && el.files && el.files[0]) {
        try {
          const file = el.files[0];
          const dataUrl = await readFileAsDataURL(file);
          // create hidden inputs: base64, name, mime
          const inpB64 = document.createElement('input'); inpB64.type='hidden';
          inpB64.name = 'file_' + entry.type + '_b64'; inpB64.value = dataUrl;
          const inpName = document.createElement('input'); inpName.type='hidden';
          inpName.name = 'file_' + entry.type + '_name'; inpName.value = file.name;
          const inpType = document.createElement('input'); inpType.type='hidden';
          inpType.name = 'file_' + entry.type + '_type'; inpType.value = file.type || 'application/octet-stream';
          hidden.appendChild(inpB64); hidden.appendChild(inpName); hidden.appendChild(inpType);
        } catch (err) {
          console.error('file read fail', entry.id, err);
        }
      }
    }

    // now submit the form to the hidden iframe (bypasses CORS)
    status.textContent = 'Uploading...';
    form.submit();
  }

  // handle response posted from iframe (Apps Script returns small HTML that posts message to parent)
  window.addEventListener('message', function(ev) {
    try {
      const data = typeof ev.data === 'string' ? JSON.parse(ev.data) : ev.data;
      const status = document.getElementById('status');
      if (data && data.success) {
        status.textContent = 'Saved successfully — Serial: ' + (data.serial || 'N/A');
        document.getElementById('empForm').reset();
      } else {
        status.textContent = 'Save failed: ' + (data && data.error ? data.error : 'unknown');
      }
    } catch (err) {
      console.error('bad message', err);
    }
  }, false);

  document.getElementById('submitBtn').addEventListener('click', prepareAndSubmit);
</script>
</body>
</html>
