<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Employee Onboarding</title>
  <style>
    :root{--primary:#0b78e3;--ok:#0b9b2b;--err:#d0342c}
    body{font-family:Inter,Arial,sans-serif;background:#f5f6f8;margin:0;padding:14px}
    .card{max-width:920px;margin:18px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 8px 22px rgba(0,0,0,0.08)}
    h1{color:var(--primary);text-align:center;margin:0 0 12px;font-size:1.4rem}
    label{display:block;margin-top:12px;font-weight:600}
    input,select,textarea{width:100%;padding:14px;border-radius:10px;border:1px solid #d4d7db;margin-top:8px;font-size:1rem;box-sizing:border-box}
    textarea{min-height:110px}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .files{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .btn-row{display:flex;gap:12px;margin-top:18px;align-items:center}
    button{flex:1;padding:14px;border-radius:10px;border:none;font-weight:700;background:var(--primary);color:#fff;font-size:1rem;cursor:pointer}
    button[disabled]{opacity:.6;cursor:default}
    .status{margin-top:14px;text-align:center;color:#222;font-weight:600}
    .status.success{color:var(--ok)}
    .status.error{color:var(--err)}
    a.folder{display:inline-block;margin-top:8px;color:var(--primary);word-break:break-all}
    .spinner{display:inline-block;width:18px;height:18px;border:3px solid rgba(0,0,0,0.08);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;vertical-align:middle;margin-left:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media(max-width:640px){.row{flex-direction:column}button{width:100%}}
    /* hidden iframe */
    #submit_iframe{display:none;width:0;height:0;border:0}
  </style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="title">
    <h1 id="title">Employee Onboarding</h1>
    <p style="text-align:center;margin:6px 0 12px;color:#555">Fill details & upload documents. Tap Submit.</p>

    <!-- ACTION set to the Apps Script exec URL you provided -->
    <form id="empForm" method="post" action="https://script.google.com/macros/s/AKfycbzgE5pJwsA_wLlTjwaY1w4cx83H7ihfFj7PD_TZgDQaTndqqO2moAK21neCw1XYa40Ftw/exec" target="submit_iframe" enctype="application/x-www-form-urlencoded" autocomplete="off">
      <label>Employee Name (As per Aadhar)
        <input name="employeeName" type="text" placeholder="Full name as on Aadhar" />
      </label>

      <div class="row">
        <div class="col">
          <label>Date of Birth
            <input name="dob" type="date" />
          </label>
        </div>
        <div class="col">
          <label>Blood Group
            <input name="bloodGroup" type="text" placeholder="O+" />
          </label>
        </div>
      </div>

      <label>Marital Status
        <select name="maritalStatus"><option value="">-- select --</option><option>Single</option><option>Married</option><option>Widowed</option><option>Divorced</option></select>
      </label>

      <label>Father name
        <input name="fatherName" type="text" />
      </label>
      <label>Permanent Address
        <textarea name="permanentAddress" placeholder="House, Street, City, PIN"></textarea>
      </label>

      <div class="row">
        <div class="col"><label>Contact No<input name="contactNo" type="text" inputmode="tel" /></label></div>
        <div class="col"><label>Emergency Contact No<input name="emergencyContactNo" type="text" inputmode="tel" /></label></div>
      </div>

      <label>Relation with Emergency Contact<input name="emergencyRelation" type="text" /></label>
      <label>Name of Emergency Contact<input name="emergencyName" type="text" /></label>
      <label>State<input name="state" type="text" /></label>

      <h3 style="margin-top:12px">Bank & Govt Info</h3>
      <label>Bank Name<input name="bankName" type="text" /></label>
      <label>Account No<input name="accountNo" type="text" /></label>
      <label>IFSC Code<input name="ifsc" type="text" /></label>
      <label>UAN Number<input name="uan" type="text" /></label>
      <label>ESI No/ WC POLICY<input name="esi" type="text" /></label>
      <label>Aadhar No<input name="aadharNo" type="text" inputmode="numeric" /></label>

      <h3 style="margin-top:10px">Family</h3>
      <label>Father name (repeat)<input name="fatherNameRepeat" type="text" /></label>

      <div class="row">
        <div class="col"><label>Father DOB<input name="fatherDob" type="date" /></label></div>
        <div class="col"><label>Mother DOB<input name="motherDob" type="date" /></label></div>
      </div>

      <label>Mother Name<input name="motherName" type="text" /></label>
      <label>Date of Marriage<input name="marriageDate" type="date" /></label>
      <label>Wife Name<input name="wifeName" type="text" /></label>
      <label>Wife DOB<input name="wifeDob" type="date" /></label>

      <label>No. Childrens<input name="noChildren" type="text" /></label>

      <h4>Child 1</h4>
      <label>Child 1 Name<input name="child1Name" type="text" /></label>
      <label>Son/Daughter<input name="child1Gender" type="text" /></label>
      <label>Child 1 DOB<input name="child1Dob" type="date" /></label>

      <h4>Child 2</h4>
      <label>Child 2 Name<input name="child2Name" type="text" /></label>
      <label>Son/Daughter<input name="child2Gender" type="text" /></label>
      <label>Child 2 DOB<input name="child2Dob" type="date" /></label>

      <h4>Child 3</h4>
      <label>Child 3 Name<input name="child3Name" type="text" /></label>
      <label>Son/Daughter<input name="child3Gender" type="text" /></label>
      <label>Child 3 DOB<input name="child3Dob" type="date" /></label>

      <label>Education<input name="education" type="text" /></label>
      <label>Scaffolding Work Experience<input name="workExperience" type="text" /></label>

      <h3 style="margin-top:12px">Upload Documents</h3>
      <div class="files">
        <label>Adhaar Front<input id="adhaarFront" type="file" accept="image/*,application/pdf" /></label>
        <label>Adhaar Back<input id="adhaarBack" type="file" accept="image/*,application/pdf" /></label>
        <label>Bank Passbook<input id="bankPassbook" type="file" accept="image/*,application/pdf" /></label>
        <label>Passport Size Photo<input id="photo" type="file" accept="image/*" /></label>
      </div>

      <!-- hidden inputs for base64 files -->
      <div id="hiddenInputs" style="display:none"></div>

      <div class="btn-row" aria-live="polite">
        <button id="submitBtn" type="button">Submit</button>
      </div>

      <div id="status" class="status" aria-atomic="true"></div>
      <div id="folderLink" style="text-align:center;margin-top:8px"></div>
    </form>

    <!-- hidden iframe -->
    <iframe name="submit_iframe" id="submit_iframe"></iframe>
  </div>

<script>
  // read file as dataURL
  function readFileAsDataURL(file) {
    return new Promise(function(resolve, reject) {
      if (!file) return resolve(null);
      var reader = new FileReader();
      reader.onload = function(e) { resolve(e.target.result); };
      reader.onerror = function(e) { reject(e); };
      reader.readAsDataURL(file);
    });
  }

  // disable/enable submit
  function setSubmitting(isSubmitting) {
    var btn = document.getElementById('submitBtn');
    if (isSubmitting) {
      btn.setAttribute('disabled','disabled');
      btn.innerHTML = 'Uploading<span class="spinner" aria-hidden="true"></span>';
    } else {
      btn.removeAttribute('disabled');
      btn.innerHTML = 'Submit';
    }
  }

  // prepare hidden file inputs and submit
  async function prepareAndSubmit() {
    var statusEl = document.getElementById('status');
    var folderEl = document.getElementById('folderLink');
    statusEl.className = 'status';
    statusEl.textContent = 'Preparing...';
    folderEl.innerHTML = '';

    // disable submit
    setSubmitting(true);

    // remove previous hidden inputs
    var hidden = document.getElementById('hiddenInputs'); hidden.innerHTML = '';

    var fileMap = [
      { id: 'adhaarFront', type: 'adhaarFront' },
      { id: 'adhaarBack',  type: 'adhaarBack' },
      { id: 'bankPassbook', type: 'bankPassbook' },
      { id: 'photo', type: 'photo' }
    ];

    try {
      for (let entry of fileMap) {
        const el = document.getElementById(entry.id);
        if (el && el.files && el.files[0]) {
          const f = el.files[0];
          // convert
          const dataUrl = await readFileAsDataURL(f);
          // inject three hidden inputs per file
          const b64 = document.createElement('input'); b64.type='hidden'; b64.name = 'file_' + entry.type + '_b64'; b64.value = dataUrl;
          const name = document.createElement('input'); name.type='hidden'; name.name = 'file_' + entry.type + '_name'; name.value = f.name;
          const m = document.createElement('input'); m.type='hidden'; m.name = 'file_' + entry.type + '_type'; m.value = f.type || 'application/octet-stream';
          hidden.appendChild(b64); hidden.appendChild(name); hidden.appendChild(m);
        }
      }
    } catch (err) {
      console.error('file read error', err);
      statusEl.className = 'status error';
      statusEl.textContent = 'File read error. Try smaller files or different browser.';
      setSubmitting(false);
      return;
    }

    // set status and attach message listener
    statusEl.textContent = 'Uploading...';

    function onMessage(ev) {
      try {
        var data = ev.data;
        if (typeof data === 'string') {
          try { data = JSON.parse(data); } catch(e) { /* ignore */ }
        }
        window.removeEventListener('message', onMessage);
        setSubmitting(false);

        if (data && data.success) {
          statusEl.className = 'status success';
          statusEl.textContent = '✅ Onboarding complete — Serial: ' + (data.serial || 'N/A');
          if (data.folderUrl) {
            folderEl.innerHTML = '<a class="folder" href="' + encodeURI(data.folderUrl) + '" target="_blank" rel="noopener">Open employee folder</a>';
          }
          try { document.getElementById('empForm').reset(); } catch(e){}
        } else {
          statusEl.className = 'status error';
          statusEl.textContent = '❌ Save failed: ' + ((data && data.error) ? data.error : JSON.stringify(data));
        }
      } catch (err) {
        window.removeEventListener('message', onMessage);
        setSubmitting(false);
        statusEl.className = 'status error';
        statusEl.textContent = 'Error reading server response';
        console.error('message handler error', err);
      }
    }

    window.addEventListener('message', onMessage, false);

    // submit form to hidden iframe
    try {
      document.getElementById('empForm').submit();
    } catch (err) {
      window.removeEventListener('message', onMessage);
      setSubmitting(false);
      statusEl.className = 'status error';
      statusEl.textContent = 'Submission failed: ' + err.message;
    }
  }

  document.getElementById('submitBtn').addEventListener('click', prepareAndSubmit);
</script>
</body>
</html>
